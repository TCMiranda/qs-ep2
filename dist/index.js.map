{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["require('es6-promise').polyfill();\nrequire('babel-polyfill');\n\nimport Joi from 'joi';\n\nconst dateValidations = {\n    dia: Joi.number().min(1).max(31),\n    mes: Joi.number().min(1).max(12),\n    ano: Joi.number().min(1860).max(2016),\n    hora: Joi.number().min(0).max(23),\n    minuto: Joi.number().min(0).max(59),\n    segundo: Joi.number().min(0).max(59)\n}\n\nconst eventDateObject = {\n    inicio_dia: dateValidations.dia,\n    inicio_mes: dateValidations.mes,\n    inicio_ano: dateValidations.ano,\n    inicio_hora: dateValidations.hora,\n    inicio_minuto: dateValidations.minuto,\n    inicio_segundo: dateValidations.segundo,\n    fim_dia: dateValidations.dia.min(Joi.ref('inicio_dia')),\n    fim_mes: dateValidations.mes.min(Joi.ref('inicio_mes')),\n    fim_ano: dateValidations.ano.min(Joi.ref('inicio_ano')),\n    fim_hora: dateValidations.hora.min(Joi.ref('inicio_hora')),\n    fim_minuto: dateValidations.minuto.min(Joi.ref('inicio_minuto')),\n    fim_segundo: dateValidations.segundo.min(Joi.ref('inicio_segundo'))\n};\n\nconst eventDateSchema = Joi.object().keys(eventDateObject).requiredKeys(...Object.keys(eventDateObject));\n\nexport default function calculaTarifa(e) {\n\n    Joi.assert(e, eventDateSchema);\n\n    const start = new Date(e.inicio_ano, e.inicio_mes - 1, e.inicio_dia, e.inicio_hora, e.inicio_minuto, e.inicio_segundo);\n    const end = new Date(e.fim_ano, e.fim_mes - 1, e.fim_dia, e.fim_hora, e.fim_minuto, e.fim_segundo);\n\n    const time_start = +start;\n    const time_end = +end;\n\n    const event_time = time_end - time_start;\n\n    Joi.assert(event_time, Joi.number().min(0));\n\n    const time_to_8 = 8 * 60 * 60 * 1000;\n    const time_to_18 = 18 * 60 * 60 * 1000;\n    const time_to_24 = 24 * 60 * 60 * 1000;\n\n    const no_promotional_time = time_to_18 - time_to_8;\n    const promotional_time = time_to_24 - no_promotional_time;\n\n    let current_time_start = (e.inicio_hora * 60 * 60 * 1000) +\n                               (e.inicio_minuto * 60 * 1000) +\n                               (e.inicio_segundo * 1000);\n\n    let missing_price_time = event_time;\n    let promotional_price_time = 0;\n\n    while (missing_price_time > 0) {\n\n        /* first slice */\n        if (current_time_start < time_to_8) {\n\n            if (current_time_start + missing_price_time > time_to_8) {\n\n                promotional_price_time += time_to_8 - current_time_start;\n                missing_price_time -= time_to_8 - current_time_start\n                current_time_start = time_to_8;\n\n            } else {\n\n                promotional_price_time += missing_price_time;\n                current_time_start += missing_price_time;\n                missing_price_time = 0;\n            }\n        }\n\n        /* second slice */\n        else if (current_time_start < time_to_18) {\n\n            if (current_time_start + missing_price_time > time_to_18) {\n\n                promotional_price_time += missing_price_time;\n                current_time_start += missing_price_time;\n                missing_price_time = 0;\n\n            } else {\n\n                current_time_start += missing_price_time;\n                missing_price_time = 0;\n            }\n        }\n\n        /* third slice */\n        else {\n\n            if (current_time_start + missing_price_time > time_to_24) {\n\n                promotional_price_time += time_to_24 - current_time_start;\n                missing_price_time -= time_to_24 - current_time_start\n                current_time_start = time_to_24;\n\n            } else {\n\n                current_time_start += missing_price_time;\n                missing_price_time = 0;\n            }\n        }\n    }\n\n    let total_price = (\n        (Math.ceil(promotional_price_time/60) * 0.2) +\n        ((Math.ceil(event_time/60) - Math.ceil(promotional_price_time/60)) * 0.4)\n    );\n\n\n    /* 15% discont after one hour */\n    (event_time > 60 * 60 * 1000) && (total_price = total_price * 0.85);\n\n    return Promise.resolve(\n        total_price/1000\n    );\n}\n"]}